{
  "schemaVersion": 2,
  "dockerfilePath": "./Dockerfile",
  "dockerfileLines": [
    "FROM node:18-alpine",
    "RUN apk add --no-cache postgresql-client curl bash",
    "WORKDIR /app",
    "COPY backend/package*.json ./",
    "RUN npm ci --only=production",
    "COPY backend/ ./",
    "RUN mkdir -p logs",
    "EXPOSE 4000",
    "ENV NODE_ENV=production",
    "ENV PORT=4000",
    "ENV USE_DEV_MODE=false",
    "CMD [\"node\", \"src/index.js\"]"
  ],
  "customNginxConfig": {
    "server": {
      "listen": "80",
      "server_name": "_",
      "location": {
        "/": {
          "proxy_pass": "http://localhost:4000",
          "proxy_set_header": {
            "Host": "$host",
            "X-Real-IP": "$remote_addr",
            "X-Forwarded-For": "$proxy_add_x_forwarded_for",
            "X-Forwarded-Proto": "$scheme"
          }
        },
        "/api": {
          "proxy_pass": "http://localhost:4000",
          "proxy_set_header": {
            "Host": "$host",
            "X-Real-IP": "$remote_addr",
            "X-Forwarded-For": "$proxy_add_x_forwarded_for",
            "X-Forwarded-Proto": "$scheme"
          }
        }
      }
    }
  }
}
